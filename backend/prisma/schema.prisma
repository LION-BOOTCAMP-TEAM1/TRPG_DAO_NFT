generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ğŸ¦ ì‚¬ìš©ì ì •ë³´ (ì§€ê°‘ ì£¼ì†Œ ì €ì¥)
model User {
  id            Int      @id @default(autoincrement())
  walletAddress String   @unique
  createdAt     DateTime @default(now())

  storyProgress StoryProgress[]
  playerNFTs    PlayerNFT[]
  Character     Character?
}

// ğŸ§™â€â™‚ï¸ ìºë¦­í„° ì •ë³´
model Character {
  id     Int  @id @default(autoincrement())
  userId Int  @unique // í•´ë‹¹ ìºë¦­í„°ë¥¼ ì†Œìœ í•œ ìœ ì €
  user   User @relation(fields: [userId], references: [id])

  name      String
  gender    String
  age       Int
  attribute String // ìºë¦­í„°ì˜ ì§ì—… ë˜ëŠ” íŠ¹ì„±

  // âœ… 6ê°œì˜ í•„ìˆ˜ ìŠ¤íƒ¯
  health       Int @default(4) // ê±´ê°•
  strength     Int @default(4) // í˜
  agility      Int @default(4) // ë¯¼ì²©
  intelligence Int @default(4) // ì§€ëŠ¥
  wisdom       Int @default(4) // ì§€í˜œ
  charisma     Int @default(4) // ë§¤ë ¥

  createdAt DateTime @default(now())
}

// ğŸ“œ ìŠ¤í† ë¦¬ (ì „ì²´ì ì¸ ì´ì•¼ê¸° íë¦„)
model Story {
  id            Int             @id @default(autoincrement())
  slug          String          @unique // URL ì¹œí™”ì ì¸ ê³ ìœ  ì‹ë³„ì (ì˜ˆ: "isekai-summoning")
  title         String // ìŠ¤í† ë¦¬ ì œëª©
  summary       String // ì „ì²´ì ì¸ ì´ì•¼ê¸° ê°œìš”
  quests        Quest[] // í€˜ìŠ¤íŠ¸ ëª©ë¡
  createdAt     DateTime        @default(now())
  BranchPoint   BranchPoint[]
  StoryProgress StoryProgress[]
  StoryScene    StoryScene[]
}

// ğŸ“– ìŠ¤í† ë¦¬ ì¥ë©´ (ìŠ¤í† ë¦¬ ì§„í–‰ ìˆœì„œì— ë”°ë¥¸ ì¥ë©´)
model StoryScene {
  id        Int      @id @default(autoincrement())
  storyId   Int
  story     Story    @relation(fields: [storyId], references: [id])
  order     Int // ìŠ¤í† ë¦¬ ì§„í–‰ ìˆœì„œ (1, 2, 3...)
  text      String // ì¥ë©´ ì„¤ëª… í…ìŠ¤íŠ¸
  createdAt DateTime @default(now())
}

// ğŸ”„ í”Œë ˆì´ì–´ì˜ ìŠ¤í† ë¦¬ ì§„í–‰ ìƒíƒœ
model StoryProgress {
  id             Int      @id @default(autoincrement())
  userId         Int
  user           User     @relation(fields: [userId], references: [id])
  storyId        Int
  story          Story    @relation(fields: [storyId], references: [id])
  currentQuestId Int
  completed      Boolean  @default(false)
  lastUpdated    DateTime @updatedAt
}

// ğŸ¯ í€˜ìŠ¤íŠ¸ (ìŠ¤í† ë¦¬ë¥¼ êµ¬ì„±í•˜ëŠ” ê°œë³„ ì´ë²¤íŠ¸)
model Quest {
  id          Int      @id @default(autoincrement())
  slug        String   @unique // URL ì¹œí™”ì ì¸ ê³ ìœ  ì‹ë³„ì (ì˜ˆ: "first-mission")
  storyId     Int
  story       Story    @relation(fields: [storyId], references: [id])
  title       String // í€˜ìŠ¤íŠ¸ ì œëª©
  description String // í€˜ìŠ¤íŠ¸ ì„¤ëª…
  choices     Choice[] // ì„ íƒì§€ ëª©ë¡
}

// ğŸ—³ï¸ ì„ íƒì§€ (í€˜ìŠ¤íŠ¸ ì§„í–‰ì„ ìœ„í•œ ì„ íƒ)
model Choice {
  id          Int         @id @default(autoincrement())
  slug        String      @unique // URL ì¹œí™”ì ì¸ ê³ ìœ  ì‹ë³„ì (ì˜ˆ: "join-knights")
  questId     Int
  quest       Quest       @relation(fields: [questId], references: [id])
  text        String // ì„ íƒ ë‚´ìš©
  nextStoryId Int? // ì„ íƒ ê²°ê³¼ì— ë”°ë¥¸ ë‹¤ìŒ ìŠ¤í† ë¦¬
  PlayerNFT   PlayerNFT[]
}

// ğŸ”€ ë¶„ê¸°ì  (DAO íˆ¬í‘œë¥¼ í†µí•œ ê¸€ë¡œë²Œ ì„ íƒ)
model BranchPoint {
  id               Int                @id @default(autoincrement())
  slug             String             @unique // URL ì¹œí™”ì ì¸ ê³ ìœ  ì‹ë³„ì (ì˜ˆ: "kingdom-destiny")
  storyId          Int
  story            Story              @relation(fields: [storyId], references: [id])
  title            String // ë¶„ê¸°ì  ì œëª© (ì˜ˆ: "ì™•êµ­ì˜ ìš´ëª… ê²°ì •")
  description      String // ë¶„ê¸°ì  ì„¤ëª…
  status           String             @default("open") // ["open", "closed"]
  daoVoteId        String? // DAO íˆ¬í‘œ ID (ì˜¨ì²´ì¸ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸)
  BranchPointScene BranchPointScene[]
}

// ğŸ“– ë¶„ê¸°ì  ì¥ë©´ (DAO íˆ¬í‘œ ì „ í•„ìš”í•œ ì„œìˆ )
model BranchPointScene {
  id            Int         @id @default(autoincrement())
  branchPointId Int
  branchPoint   BranchPoint @relation(fields: [branchPointId], references: [id])
  order         Int // DAO ìŠ¤í† ë¦¬ ì„¤ëª… ìˆœì„œ
  text          String // DAO íˆ¬í‘œ ì „ í•„ìš”í•œ ì„œìˆ 
}

// ğŸ† NFT ë°œê¸‰ ë‚´ì—­ (ìŠ¤í† ë¦¬ ì„ íƒì„ NFTë¡œ ì €ì¥)
model PlayerNFT {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  nftTokenId String // NFT ì˜¨ì²´ì¸ í† í° ID
  choiceId   Int?
  choice     Choice?  @relation(fields: [choiceId], references: [id]) // ì–´ë–¤ ì„ íƒì„ NFTë¡œ ë°œê¸‰í–ˆëŠ”ì§€
  createdAt  DateTime @default(now())
}
